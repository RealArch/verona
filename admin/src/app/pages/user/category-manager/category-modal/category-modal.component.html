<ion-header>
  <ion-toolbar color="primary">
    <ion-title>{{ category ? 'Editar' : 'Nueva' }} Categoría</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="categoryForm">
    <ion-item class="rounded-lg mb-3">
      <ion-label position="floating">Nombre de la Categoría</ion-label>
      <ion-input formControlName="name" type="text" required></ion-input>
    </ion-item>

    <!-- Imagen (solo categorías principales) -->
    <div *ngIf="!parentId" class="mt-4">
      <ion-label class="block mb-2">Imagen de la Categoría</ion-label>
      <div class="flex justify-center">
        <div class="relative w-[220px] h-[150px] rounded-xl border-2 border-dashed border-medium bg-light hover:border-primary transition cursor-pointer overflow-hidden" (click)="fileInput.click()">
          <ng-container *ngIf="!imageUpload; else showImage">
            <div class="h-full w-full flex flex-col items-center justify-center text-medium">
              <ion-icon name="camera-outline" class="text-3xl"></ion-icon>
              <span class="mt-1 text-xs">Subir Imagen</span>
            </div>
          </ng-container>
          <ng-template #showImage>
            <ion-img [src]="imageUpload!.previewUrl" class="w-full h-full object-cover"></ion-img>
            <div *ngIf="imageUpload!.uploading" class="absolute inset-0 bg-black/30 flex flex-col items-center justify-center text-white">
              <ion-spinner></ion-spinner>
              <span class="mt-2 text-xs">{{ imageUpload!.progress.toFixed(0) }}%</span>
            </div>
            <ion-button *ngIf="!imageUpload!.uploading" color="danger" size="small" class="absolute top-1 right-1 rounded-full" (click)="removeImageWithStopPropagation($event)">
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </ng-template>
        </div>
      </div>
      <input type="file" hidden #fileInput (change)="onFileSelected($event)" accept="image/*" />
    </div>

  </form>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button fill="outline" color="medium" (click)="cancel()">Cancelar</ion-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-button color="primary" (click)="save()" [disabled]="categoryForm.invalid || isSaving">
        <ion-spinner *ngIf="isSaving" name="crescent" slot="start"></ion-spinner>
        Guardar
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>


<!-- anade al admin un botn en el manu debajo de categorias que se llame productos. alli dentro tendremos el sistema de
productos. necesito:



-en la pagina principal d eproductos, un selector que me permita elegir por productos, activos y pausados. de acuerdo a
lo que selecciones, que me muestre una lista de los productos con la infomas importante. incluyendo la foto thumb. Un
boton tipo ion fab button abajo a la derecha con el simbolo d emas qu epermita anadir productos. eso vaya una oagina
siguiente donde podre publicar el articulo. quiero que ese formulario de reactive formas con formbuilder tenga too lo
necesario para subir un articulo. guia te por lo que piden los cms generalmentepara la publicacion d eun articulo.
incluye el selector de categroia para aplicar las actegorias existentes que hemos creado antes. para las fotos, permite
arrastarr o buscar en en almacenmiento o tomar foto si esta en un dispositivo movil. que en loq ue se seleccione la foto
=, se suba a una carpeta temporaral del storage, se vea la foto que se subio enuna miniatura y s eperita borrar. una vez
s efinalice la ediciond el articulo, se envie la data a un endpoint en el servicio articulos y que vaya el backend
firebase functions. luego alli en functions, reciba la data la guarde, la sume a los metadatos de conteo de prodcutos, y
ponga el status del articulo en procesando. luego que guarde la data se active una funcion automatica que procese las
imagenes. generele lonecesario para obetenr las imagene spara los tamanos standard y thumbnail y las comprima lo mas
optimo posible. luego compie las imagenes en la carpeta de storage en la ruta img/products y las borre de la carpeta
temporal. si todo sale bien, obetenr el url de la foto y ponerla dentro del objeto del articulo en firestore para poder
acceder a el. lo gaurde en la db y actualice el estatus a activo -->