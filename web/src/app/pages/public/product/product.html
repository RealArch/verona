<div class="min-h-screen bg-base-100 pt-20">
    <!-- Loading State -->
    @if (loading()) {
    <div class="container mx-auto px-4 py-8">
        <div class="flex justify-center items-center min-h-96">
            <div class="loading loading-spinner loading-lg"></div>
        </div>
    </div>
    }

    <!-- Error State -->
    @if (error() && !loading()) {
    <div class="container mx-auto px-4 py-8">
        <div class="alert alert-error">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>{{ error() }}</span>
        </div>
    </div>
    }

    <!-- Product Content -->
    @if (currentProduct() && !loading()) {
    <div class="container mx-auto px-4 py-4">
        <div class="text-sm breadcrumbs">
            <ul>
                <li><a class="text-primary hover:text-primary-focus">Inicio</a></li>
                @for (catId of getCategoryPath(currentProduct()!.categoryId); track catId) {
                <li><a class="text-primary hover:text-primary-focus">{{ catId }}</a></li>
                }
                <li class="text-base-content">{{ currentProduct()!.name }}</li>
            </ul>
        </div>
    </div>

    <!-- Main Product Section -->
    <div class="container mx-auto px-4 pb-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- Product Images -->
            <div class="space-y-4">
                <!-- Main Image -->
                <div class="relative bg-base-200 rounded-2xl overflow-hidden group">
                    <div class="aspect-square">
                        @if (mainImage()) {
                        <img [src]="mainImage()!.large.url" [alt]="currentProduct()!.name"
                            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
                        } @else {
                        <div class="w-full h-full flex items-center justify-center text-base-content/50">
                            Sin imagen disponible
                        </div>
                        }
                    </div>
                    <!-- Zoom Icon -->
                    <div
                        class="absolute top-4 right-4 bg-white/80 backdrop-blur-sm rounded-full p-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                        </svg>
                    </div>
                </div>

                <!-- Thumbnail Images -->
                <div class="grid grid-cols-4 gap-3">
                    @for (photo of currentProduct()!.photos; track photo; let i = $index) {
                    <div class="aspect-square bg-base-200 rounded-lg overflow-hidden cursor-pointer transition-all"
                        [class.ring-2]="currentImageIndex() === i" [class.ring-primary]="currentImageIndex() === i"
                        [class.hover:ring-2]="currentImageIndex() !== i"
                        [class.hover:ring-primary]="currentImageIndex() !== i" (click)="selectImage(i)">
                        <img [src]="photo.small.url" [alt]="'Vista ' + (i + 1)"
                            class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
                    </div>
                    }
                </div>
            </div>

            <!-- Product Info -->
            <div class="space-y-6">
                <!-- SKU -->
                <!-- <div class="text-sm text-base-content/60">
                    SKU: {{ currentProduct()!.sku }}
                </div> -->

                <!-- Title & Brand -->
                <div>
                    <!-- <div class="text-sm text-primary font-medium mb-1">VERONA</div> -->
                    <h1 class="text-3xl lg:text-4xl font-light text-base-content mb-2">{{ currentProduct()!.name }}</h1>
                </div>

                <!-- Price -->
                <div class="space-y-2">
                    <div class="flex items-baseline gap-3">
                        <span class="text-3xl font-semibold text-primary"> {{ currentPrice() | currency }}</span>
                    </div>
                </div>

                <!-- Stock Status -->
                <div class="flex items-center gap-2">
                    @if (isInStock()) {
                    <div class="w-3 h-3 bg-success rounded-full"></div>
                    <span class="text-success font-medium">En stock ({{ currentStock() }} unidades disponibles)</span>
                    } @else {
                    <div class="w-3 h-3 bg-error rounded-full"></div>
                    <span class="text-error font-medium">Agotado</span>
                    }
                </div>

                <!-- Product Variants -->
                @if (currentProduct()!.variants && currentProduct()!.variants.length > 0) {
                <div class="space-y-4">
                    <div>
                        <h3 class="text-sm font-medium text-base-content mb-3">
                            Variantes disponibles:
                            <span class="font-normal">{{ selectedVariant()?.name || 'Selecciona una variante' }}</span>
                        </h3>
                        <div class="flex flex-wrap gap-2">
                            @for (variant of currentProduct()!.variants; track variant.id) {
                            <div class="inline-flex items-center border rounded-full px-2 py-1 cursor-pointer transition-all whitespace-nowrap"
                                [class.border-primary]="selectedVariant()?.id === variant.id"
                                [class.bg-primary/10]="selectedVariant()?.id === variant.id"
                                [class.border-base-300]="selectedVariant()?.id !== variant.id"
                                (click)="selectVariant(variant)">
                                @if (variant.colorHex) {
                                <div class="w-4 h-4 rounded-full border border-base-300 mr-2"
                                    [style.background-color]="variant.colorHex"></div>
                                }
                                <span class="font-medium mr-2">{{ variant.name }}</span>
                                <!-- <span class="text-sm text-base-content/60 mr-2">{{ variant.sku }}</span> -->
                                <span class="font-semibold">{{ variant.price | currency }}</span>
                            </div>
                            }
                        </div>
                    </div>
                </div>
                }

                <!-- Quantity & Add to Cart -->
                <div class="space-y-4">
                    <div>
                        <h3 class="text-sm font-medium text-base-content mb-3">Cantidad</h3>
                        <div class="flex items-center gap-4">
                            <div class="join">
                                <button class="btn join-item btn-outline" (click)="decreaseQuantity()"
                                    [disabled]="selectedQuantity() <= 1">-</button>
                                <input type="number" [value]="selectedQuantity()"
                                    class="input join-item input-bordered w-16 text-center" [min]="1"
                                    [max]="currentStock()" readonly>
                                <button class="btn join-item btn-outline" (click)="increaseQuantity()"
                                    [disabled]="selectedQuantity() >= currentStock()">+</button>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button 
                            class="btn btn-lg flex-1 transition-all duration-300" 
                            [class.btn-primary]="!isInCart() && isInStock() && !addingToCart()"
                            [class.btn-success]="isInCart()"
                            [class.btn-disabled]="!isInStock() || addingToCart()"
                            [disabled]="!isInStock() || addingToCart()" 
                            (click)="addToCart()">
                            
                            @if (addingToCart()) {
                                <span class="loading loading-spinner loading-sm mr-2"></span>
                            } @else if (isInCart()) {
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 13l4 4L19 7"></path>
                                </svg>
                            } @else {
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5 6m0 0h9m-9 0h9"></path>
                                </svg>
                            }
                            
                            {{ addToCartButtonText() }}
                        </button>
                        <button class="btn btn-outline btn-lg" (click)="addToWishlist()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Quick Info Cards -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-primary/10 rounded-lg p-4 text-center">
                        <svg class="w-6 h-6 mx-auto mb-2 text-primary" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                        </svg>
                        <div class="text-sm font-medium">Envío Gratis</div>
                        <div class="text-xs text-base-content/60">Lima Metropolitana</div>
                    </div>
                    <div class="bg-primary/10 rounded-lg p-4 text-center">
                        <svg class="w-6 h-6 mx-auto mb-2 text-primary" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="text-sm font-medium">Garantía</div>
                        <div class="text-xs text-base-content/60">2 años</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Details Tabs -->
        <div class="mt-12">
 
            <h2 class="text-2xl md:text-3xl font-light text-center mb-8 text-base-content">Descripción</h2>

            <div class="mt-6 bg-base-300/50 rounded-2xl p-8 lg:p-15 ">
                <!-- Description Tab Content -->
                <div class="prose prose-lg max-w-none w-full break-words [&_ul]:list-disc [&_ul]:pl-6 [&_li]:ml-0 [&_ol]:list-decimal [&_ol]:pl-6" [innerHTML]="currentProduct()?.description">

                </div>


            </div>
        </div>
    </div>

    <!-- Related Products -->
    <div class="bg-base-200/30 py-12 mt-12">
        <div class="container mx-auto px-4">
            <h2 class="text-2xl md:text-3xl font-light text-center mb-8 text-base-content">Productos Relacionados</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6">
                <!-- Related Product Card -->
                @for (product of relatedProducts(); track product.id) {
                 <app-product-item [product]="product"></app-product-item>
                }
            </div>
        </div>
    </div>
    }
</div>